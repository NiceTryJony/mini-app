<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager - –¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e1b4b 0%, #0f0f23 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 30px;
            background: linear-gradient(90deg, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .test-result {
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .test-result.loading {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
        }

        .test-result.success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .test-result.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        button {
            background: linear-gradient(90deg, #a855f7, #ec4899);
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
        }

        button:active {
            transform: scale(0.98);
        }

        .info {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Task Manager - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>

        <div class="info">
            –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
            –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤.
        </div>

        <!-- Test 1: API URL -->
        <div class="test-section">
            <div class="test-title">1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ API URL</div>
            <button onclick="testApiUrl()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <div id="test1" class="test-result"></div>
        </div>

        <!-- Test 2: Ping -->
        <div class="test-section">
            <div class="test-title">2Ô∏è‚É£ –¢–µ—Å—Ç /ping endpoint</div>
            <button onclick="testPing()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <div id="test2" class="test-result"></div>
        </div>

        <!-- Test 3: Get Tasks -->
        <div class="test-section">
            <div class="test-title">3Ô∏è‚É£ –¢–µ—Å—Ç GET /api/tasks</div>
            <button onclick="testGetTasks()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <div id="test3" class="test-result"></div>
        </div>

        <!-- Test 4: Get Users -->
        <div class="test-section">
            <div class="test-title">4Ô∏è‚É£ –¢–µ—Å—Ç GET /api/users</div>
            <button onclick="testGetUsers()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <div id="test4" class="test-result"></div>
        </div>

        <!-- Test 5: Create User -->
        <div class="test-section">
            <div class="test-title">5Ô∏è‚É£ –¢–µ—Å—Ç POST /api/user/register</div>
            <button onclick="testCreateUser()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <div id="test5" class="test-result"></div>
        </div>

        <!-- Test 6: Create Task -->
        <div class="test-section">
            <div class="test-title">6Ô∏è‚É£ –¢–µ—Å—Ç POST /api/tasks</div>
            <button onclick="testCreateTask()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <div id="test6" class="test-result"></div>
        </div>

        <!-- Run All -->
        <div class="test-section" style="background: linear-gradient(90deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.1));">
            <div class="test-title">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</div>
            <button onclick="runAllTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
        </div>
    </div>

    <script>
        const API_URL = 'https://mini-app-2pze.onrender.com';

        function log(message, data = null) {
            console.log(`[TEST] ${message}`, data || '');
        }

        function showResult(elementId, status, message) {
            const el = document.getElementById(elementId);
            el.className = `test-result ${status}`;
            el.textContent = message;
        }

        // Test 1: API URL
        async function testApiUrl() {
            log('Testing API URL');
            showResult('test1', 'loading', '–ü—Ä–æ–≤–µ—Ä–∫–∞...');
            
            try {
                const url = new URL(API_URL);
                showResult('test1', 'success', 
                    `‚úÖ API URL –≤–∞–ª–∏–¥–Ω—ã–π\n\n` +
                    `Protocol: ${url.protocol}\n` +
                    `Host: ${url.host}\n` +
                    `Full URL: ${API_URL}`
                );
            } catch (error) {
                showResult('test1', 'error', 
                    `‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π API URL\n\n` +
                    `Error: ${error.message}\n` +
                    `URL: ${API_URL}`
                );
            }
        }

        // Test 2: Ping
        async function testPing() {
            log('Testing /ping endpoint');
            showResult('test2', 'loading', '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${API_URL}/ping`);
                const duration = Date.now() - startTime;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log('Ping response:', data);
                
                showResult('test2', 'success', 
                    `‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç (${duration}ms)\n\n` +
                    `Status: ${data.status}\n` +
                    `Timestamp: ${data.timestamp}\n` +
                    `Response time: ${duration}ms`
                );
            } catch (error) {
                log('Ping error:', error);
                showResult('test2', 'error', 
                    `‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n\n` +
                    `Error: ${error.message}\n` +
                    `URL: ${API_URL}/ping\n\n` +
                    `–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n` +
                    `- –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω\n` +
                    `- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL\n` +
                    `- CORS –ø—Ä–æ–±–ª–µ–º–∞\n` +
                    `- –°–µ—Ä–≤–µ—Ä "—Å–ø–∏—Ç" (Render free tier)`
                );
            }
        }

        // Test 3: Get Tasks
        async function testGetTasks() {
            log('Testing GET /api/tasks');
            showResult('test3', 'loading', '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
            
            try {
                const response = await fetch(`${API_URL}/api/tasks`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log('Tasks response:', data);
                
                showResult('test3', 'success', 
                    `‚úÖ –£—Å–ø–µ—à–Ω–æ\n\n` +
                    `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á: ${data.length}\n` +
                    `Response:\n${JSON.stringify(data, null, 2).substring(0, 300)}...`
                );
            } catch (error) {
                log('Get tasks error:', error);
                showResult('test3', 'error', 
                    `‚ùå –û—à–∏–±–∫–∞\n\n` +
                    `Error: ${error.message}\n` +
                    `URL: ${API_URL}/api/tasks`
                );
            }
        }

        // Test 4: Get Users
        async function testGetUsers() {
            log('Testing GET /api/users');
            showResult('test4', 'loading', '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
            
            try {
                const response = await fetch(`${API_URL}/api/users`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log('Users response:', data);
                
                showResult('test4', 'success', 
                    `‚úÖ –£—Å–ø–µ—à–Ω–æ\n\n` +
                    `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${data.length}\n` +
                    `Response:\n${JSON.stringify(data, null, 2).substring(0, 300)}...`
                );
            } catch (error) {
                log('Get users error:', error);
                showResult('test4', 'error', 
                    `‚ùå –û—à–∏–±–∫–∞\n\n` +
                    `Error: ${error.message}\n` +
                    `URL: ${API_URL}/api/users`
                );
            }
        }

        // Test 5: Create User
        async function testCreateUser() {
            log('Testing POST /api/user/register');
            showResult('test5', 'loading', '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
            
            const testUser = {
                telegram_id: Math.floor(Math.random() * 1000000),
                username: `test_user_${Date.now()}`,
                first_name: 'Test User',
                photo_url: null,
                timezone: 'Europe/Kiev',
                language: 'uk'
            };
            
            try {
                const response = await fetch(`${API_URL}/api/user/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testUser)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log('Create user response:', data);
                
                showResult('test5', 'success', 
                    `‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\n\n` +
                    `Username: ${data.username}\n` +
                    `Telegram ID: ${data.telegram_id}\n` +
                    `Response:\n${JSON.stringify(data, null, 2)}`
                );
            } catch (error) {
                log('Create user error:', error);
                showResult('test5', 'error', 
                    `‚ùå –û—à–∏–±–∫–∞\n\n` +
                    `Error: ${error.message}\n` +
                    `URL: ${API_URL}/api/user/register`
                );
            }
        }

        // Test 6: Create Task
        async function testCreateTask() {
            log('Testing POST /api/tasks');
            showResult('test6', 'loading', '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
            
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            
            const testTask = {
                title: `Test Task ${Date.now()}`,
                description: 'This is a test task',
                preparation_date: tomorrow.toISOString(),
                event_date: nextWeek.toISOString(),
                created_by: 12345,
                created_by_username: 'test_user'
            };
            
            try {
                const response = await fetch(`${API_URL}/api/tasks`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testTask)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                log('Create task response:', data);
                
                showResult('test6', 'success', 
                    `‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–¥–∞—á–∞\n\n` +
                    `Title: ${data.title}\n` +
                    `ID: ${data.id}\n` +
                    `Status: ${data.status}\n` +
                    `Response:\n${JSON.stringify(data, null, 2).substring(0, 300)}...`
                );
            } catch (error) {
                log('Create task error:', error);
                showResult('test6', 'error', 
                    `‚ùå –û—à–∏–±–∫–∞\n\n` +
                    `Error: ${error.message}\n` +
                    `URL: ${API_URL}/api/tasks`
                );
            }
        }

        // Run all tests
        async function runAllTests() {
            log('Running all tests...');
            
            await testApiUrl();
            await new Promise(r => setTimeout(r, 500));
            
            await testPing();
            await new Promise(r => setTimeout(r, 500));
            
            await testGetTasks();
            await new Promise(r => setTimeout(r, 500));
            
            await testGetUsers();
            await new Promise(r => setTimeout(r, 500));
            
            await testCreateUser();
            await new Promise(r => setTimeout(r, 500));
            
            await testCreateTask();
            
            log('All tests completed!');
        }
    </script>
</body>
</html>